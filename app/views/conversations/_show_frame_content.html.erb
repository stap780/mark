<%= turbo_frame_tag dom_id(current_account, :conversation), class: "flex-1 min-h-0 flex flex-col h-full" do %>
  <%= turbo_stream_from dom_id(current_account, dom_id(conversation, :messages)) %>
  <div class="flex-1 min-h-0 flex flex-col overflow-hidden">
    <div class="p-4 border-b bg-gray-50">
      <div class="flex items-start justify-between gap-4 mb-2">
        <div>
          <h2 class="text-lg font-semibold text-gray-900">
            <%= t('conversations.show.title', name: client.name) %>
          </h2>
          <div class="flex flex-wrap gap-4 text-sm text-gray-600 mt-1">
            <% if client.email.present? %>
              <span><span class="font-medium">Email:</span> <%= client.email %></span>
            <% end %>
            <% if client.phone.present? %>
              <span><span class="font-medium">Телефон:</span> <%= client.phone %></span>
            <% end %>
          </div>
        </div>
        <div class="flex gap-2">
          <% if conversation.active? %>
            <%= button_to t('conversations.close.action'), close_account_conversation_path(current_account, conversation), method: :patch, class: "px-2 py-1 text-sm rounded-md border border-gray-300 bg-white text-gray-700 hover:bg-gray-50", data: { turbo_confirm: t('conversations.close.confirm'), turbo_stream: true, turbo_prefetch: false  } %>
          <% else %>
            <%= button_to t('conversations.reopen.action'), reopen_account_conversation_path(current_account, conversation), method: :patch, class: "px-2 py-1 text-sm rounded-md bg-violet-600 text-white hover:bg-violet-700", data: { turbo_stream: true, turbo_prefetch: false  } %>
          <% end %>
          <%= link_to t('incases.new.heading'), new_account_incase_path(current_account, client_id: client.id), data: { turbo_frame: :offcanvas, turbo_prefetch: false }, class: "inline-flex items-center px-2 py-1 text-sm rounded-md border border-violet-600 text-violet-600 bg-white hover:bg-violet-50" %>
        </div>
      </div>
    </div>
    <div class="flex-1 min-h-0 overflow-y-auto p-4" data-controller="scroll-to-bottom">
      <%= render 'conversations/conversation_timeline', conversation: conversation, messages: messages, current_account: current_account %>
    </div>
    <div class="p-4 border-t bg-gray-50">
      <%= render 'conversations/send_message_form', conversation: conversation, current_account: current_account %>
    </div>
  </div>
<% end %>
