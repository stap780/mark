<div class="bg-white rounded-lg shadow p-4">
  <div class="flex items-center justify-between mb-4">
    <%= link_to t('back'), account_incases_path(current_account), class: "text-gray-600 hover:text-violet-700 text-sm" %>
    <h1 class="text-xl font-semibold"><%= t('incases.index.incase') %> #<%= @incase.id %></h1>
    <div class="flex space-x-2">
      <%= form_with url: update_status_account_incase_path(current_account, @incase), method: :patch, local: false, data: { turbo: true }, class: "inline-flex items-center" do |f| %>
        <%= f.select :status, 
            options_for_select(
              Incase.statuses.keys.map { |k| [t("incases.status.#{k}"), k] },
              @incase.status
            ),{},
            { 
              onchange: "this.form.requestSubmit()",
              class: "px-3 py-1 border border-gray-300 rounded-md bg-white text-gray-700 focus:outline-none focus:ring-2 focus:ring-violet-500 focus:border-violet-500"
            } %>
      <% end %>
    </div>
  </div>

  <div class="grid grid-cols-2 gap-4 mb-4">
    <%= turbo_frame_tag dom_id(current_account, dom_id(@incase, :status)) do %>
      <div class="p-3 bg-gray-50 rounded">
        <p class="text-sm text-gray-600"><%= t('incases.index.status') %></p>
        <p class="font-medium"><%= t("incases.status.#{@incase.status}") %></p>
      </div>
    <% end %>
    <div class="p-3 bg-gray-50 rounded">
      <p class="text-sm text-gray-600"><%= t('incases.index.created_at') %></p>
      <p class="font-medium"><%= l @incase.created_at, format: :short %></p>
    </div>
    <div class="p-3 bg-gray-50 rounded">
      <p class="text-sm text-gray-600"><%= t('incases.index.webform') %></p>
      <p class="font-medium"><%= @incase.webform&.title %> (<%= @incase.webform.kind %>)</p>
    </div>
    <div class="p-3 bg-gray-50 rounded">
      <p class="text-sm text-gray-600"><%= t('incases.index.client') %></p>
      <p class="font-medium"><%= @incase.client.name %></p>
      <p class="text-sm text-gray-500"><%= @incase.client.email %></p>
      <p class="text-sm text-gray-500"><%= @incase.client.phone %></p>
    </div>
  </div>

  <h3 class="text-lg font-semibold mb-2"><%= t('incases.index.items') %></h3>
  <div class="bg-white rounded-lg shadow divide-y">
    <div class="grid grid-cols-[2fr_100px_100px_100px] gap-4 p-4 font-medium text-gray-700">
      <div><%= t('incases.index.product') %></div>
      <div><%= t('incases.index.quantity') %></div>
      <div><%= t('incases.index.price') %></div>
      <div><%= t('incases.index.sum') %></div>
    </div>
    <% @incase.items.each do |item| %>
      <div class="grid grid-cols-[2fr_100px_100px_100px] gap-4 p-4 hover:bg-gray-50">
        <div><%= item.product.title %> (Variant ID: <%= item.variant.id %>)</div>
        <div><%= item.quantity %></div>
        <div><%= item.price %></div>
        <div><%= item.sum %></div>
      </div>
    <% end %>
      <div class="grid grid-cols-[2fr_100px_100px_100px] gap-4 p-4 hover:bg-gray-50">
      <div><%= t('incases.index.total') %></div>
      <div><%= @incase.items.pluck(:quantity).sum %></div>
      <div><%= @incase.items.pluck(:price).sum %></div>
      <div><%= @incase.items.map(&:sum).sum %></div>
      </div>
  </div>
</div>

