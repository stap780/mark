
<%= form_with model: request.path.include?('/admin/') ? [:admin, account, user] : [account, user], 
              data: { turbo_frame: :offcanvas }, 
              class: "contents" do |form| %>

  <%= render "shared/errors", object: form.object if form.object %>

  <div class="my-5">
    <%= form.label :email_address, class: "block text-sm font-medium text-gray-700" %>
    <%= form.email_field :email_address, 
          class: ["block shadow-sm rounded-md border px-3 py-2 mt-2 w-full", {"border-gray-400 focus:outline-blue-600": form.object&.errors&.[](:email_address)&.none? != false, "border-red-400 focus:outline-red-600": form.object&.errors&.[](:email_address)&.any?}],
          placeholder: "user@example.com" %>
  </div>
  
  <div class="my-5">
    <%= form.label :password, class: "block text-sm font-medium text-gray-700" %>
    <%= form.password_field :password, 
          class: ["block shadow-sm rounded-md border px-3 py-2 mt-2 w-full", {"border-gray-400 focus:outline-blue-600": form.object&.errors&.[](:password)&.none? != false, "border-red-400 focus:outline-red-600": form.object&.errors&.[](:password)&.any?}],
          placeholder: form.object&.persisted? ? "Leave blank to keep current password" : "Password" %>
    <% if form.object&.persisted? %>
      <p class="mt-1 text-sm text-gray-500">Leave blank to keep current password</p>
    <% end %>
  </div>
  
  <div class="my-5">
    <%= form.label :password_confirmation, class: "block text-sm font-medium text-gray-700" %>
    <%= form.password_field :password_confirmation, 
          class: ["block shadow-sm rounded-md border px-3 py-2 mt-2 w-full", {"border-gray-400 focus:outline-blue-600": form.object&.errors&.[](:password_confirmation)&.none? != false, "border-red-400 focus:outline-red-600": form.object&.errors&.[](:password_confirmation)&.any?}],
          placeholder: "Confirm password" %>
  </div>
  
  <div class="my-5">
    <%= form.label :role, "Role", class: "block text-sm font-medium text-gray-700" %>
    <%= form.fields_for :account_users, account_user do |f| %>
      <% if account_user&.account_id == account.id %>
        <%= f.hidden_field :id %>
        <%= f.hidden_field :account_id, value: account.id %>
        <% collection = AccountUser.roles.keys.map { |role| [role.humanize, role] } %>
        <%= f.select :role, collection, { selected: account_user&.role }, 
            { class: "block shadow-sm rounded-md border px-3 py-2 mt-2 w-full border-gray-400 focus:outline-blue-600" } %>
      <% end %>
    <% end %>
  </div>
  
  <div class="flex justify-start space-x-3 pt-4">
    <%= form.submit form.object&.persisted? ? "Update User" : "Create User",
          class: "inline-flex items-center px-3 py-1 bg-violet-600 text-white rounded-md hover:bg-violet-700" %>
    <button type="button" 
            class="inline-flex items-center px-3 py-1 bg-white text-violet-700 border border-violet-600 rounded-md hover:bg-violet-50"
            data-action="click->offcanvas#close">
      Cancel
    </button>
  </div>
<% end %>