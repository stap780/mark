<div class="flex items-center justify-between mb-4">
  <h1 class="text-xl font-semibold"><%= t("swatch_groups.show.heading", name: @swatch_group.name) %></h1>
  <div class="space-x-2">
    <%= link_to_edit edit_account_swatch_group_path(current_account, @swatch_group), class: "inline-flex items-center px-3 py-1 bg-violet-600 text-white rounded-md hover:bg-violet-700" %>
    <%= link_to t(:toggle_status), toggle_status_account_swatch_group_path(current_account, @swatch_group), method: :patch, class: "inline-flex items-center px-3 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700" %>
    <%= link_to t(:regenerate_json), regenerate_json_account_swatch_groups_path(current_account), method: :post, class: "inline-flex items-center px-3 py-1 bg-blue-600 text-white rounded-md hover:bg-blue-700" %>
  </div>
  </div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
  <div class="bg-white rounded-lg shadow p-4">
    <h2 class="text-lg font-semibold mb-4"><%= t(:assigned_products) %></h2>
    <div class="space-y-2">
      <% @assigned_products.each do |sgp| %>
        <div class="flex items-center justify-between p-2 border rounded">
          <div class="flex items-center space-x-2">
            <% v = sgp.product.variants.joins(:varbinds).where(varbinds: { value: sgp.swatch_value }).first %>
            <img src="<%= v&.image_link.presence || sgp.product.image_link %>" class="h-8 w-8 object-cover rounded" onerror="this.style.display='none'">
            <div>
              <div class="font-medium"><%= sgp.product.title %></div>
              <div class="text-sm text-gray-600"><%= t(:label) %>: <%= sgp.swatch_label %> • <%= t(:value) %>: <%= sgp.swatch_value %>
                <% if v %>
                  • <%= t(:price) %>: <%= v.price %>
                <% end %>
              </div>
            </div>
          </div>
          <div class="space-x-2">
            <%= link_to t(:remove), account_swatch_group_swatch_group_product_path(current_account, @swatch_group, sgp), data: { turbo_method: :delete, turbo_confirm: t(:remove_product) }, class: "text-red-600 hover:underline" %>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <div class="bg-white rounded-lg shadow p-4">
    <h2 class="text-lg font-semibold mb-4"><%= t(:add_product_to_group) %></h2>
    <%= form_with url: account_swatch_group_swatch_group_products_path(current_account, @swatch_group), scope: :swatch_group_product, class: "space-y-3" do |f| %>
      <div>
        <%= f.label :product_id, class: "block text-sm font-medium text-gray-700" %>
        <%= f.collection_select :product_id, @available_products, :id, :title, {}, class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-violet-500 focus:ring-violet-500 px-3 py-2.5" %>
      </div>
      <div class="grid grid-cols-2 gap-4">
        <div>
          <%= f.label :swatch_label, class: "block text-sm font-medium text-gray-700" %>
          <%= f.text_field :swatch_label, class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-violet-500 focus:ring-violet-500 px-3 py-2.5" %>
        </div>
        <div>
          <%= f.label :swatch_value, class: "block text-sm font-medium text-gray-700" %>
          <%= f.text_field :swatch_value, placeholder: "#RRGGBB or URL", class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-violet-500 focus:ring-violet-500 px-3 py-2.5" %>
        </div>
      </div>
      <div>
        <%= f.label :custom_image_url, class: "block text-sm font-medium text-gray-700" %>
        <%= f.text_field :custom_image_url, class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-violet-500 focus:ring-violet-500 px-3 py-2.5" %>
      </div>
      <div>
        <%= f.submit t(:add), class: "inline-flex items-center px-3 py-1 bg-violet-600 text-white rounded-md hover:bg-violet-700" %>
      </div>
    <% end %>
  </div>
</div>
