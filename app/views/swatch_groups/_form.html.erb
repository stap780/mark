<%= form_with model: [current_account, swatch_group], class: "space-y-6" do |f| %>
  <%= render 'shared/errors', object: swatch_group %>
  <div class="grid grid-cols-1 lg:grid-cols-[2fr_1fr] gap-6">
    <!-- Left column: basic info + products -->
    <div class="space-y-6">
      <div class="bg-white rounded-lg border p-4 space-y-4">
        <div>
          <%= f.label :name, class: "block text-sm font-medium text-gray-700" %>
          <%= f.text_field :name, class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-violet-500 focus:ring-violet-500 px-3 py-2.5" %>
        </div>
        <div>
          <%= f.label :option_name, class: "block text-sm font-medium text-gray-700" %>
          <%= f.text_field :option_name, class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-violet-500 focus:ring-violet-500 px-3 py-2.5" %>
        </div>
      </div>

      <div class="bg-white rounded-lg border p-4">
        <div class="flex items-center justify-between mb-3">
          <h3 class="text-sm font-medium text-gray-700">Items</h3>

          <%= link_to "Add items", 
            items_picker_account_swatch_group_path(current_account, turbo_id_for(swatch_group)),
            data: { turbo_frame: :offcanvas, turbo_prefetch: false },
            class: "inline-flex items-center px-3 py-1 border rounded-md text-gray-700 hover:bg-gray-50" %>
          
          <%# link_to "Add", new_account_swatch_group_swatch_group_product_path(current_account, turbo_id_for(swatch_group)),
            data: { turbo_stream: true },
            class: "p-2 rounded-md bg-blue-300 hover:bg-blue-400" %>
        </div>

        <%= turbo_frame_tag dom_id(current_account, :swatch_group_products), class: "space-y-2" do %>
          <%= render partial: "swatch_group_products/swatch_group_product",
           collection: swatch_group.swatch_group_products,
           as: :swatch_group_product,
           locals: { swatch_group: swatch_group } %>
        <% end %>

      </div>
    </div>

    <!-- Right column: status + styles + image source -->
    <div class="space-y-6">
      <div class="bg-white rounded-lg border p-4">
        <%= f.label :status, class: "block text-sm font-medium text-gray-700" %>
        <%= f.select :status, SwatchGroup.statuses.keys, {}, class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-violet-500 focus:ring-violet-500 px-3 py-2.5" %>
      </div>

      <div class="bg-white rounded-lg border p-4 space-y-4">
        <div>
          <%= render "swatch_groups/style_field", field: 'product_page_style', value: swatch_group.product_page_style, label: (SwatchGroup.style_label_for(swatch_group.product_page_style) || 'Not selected') %>
          <div class="mt-3">
            <label class="block text-sm font-medium text-gray-700">Swatch image source</label>
            <%= f.select :swatch_image_source,
                options_for_select(SwatchGroup::SWATCH_IMAGE_SOURCE, swatch_group.swatch_image_source),
                {},
                class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-violet-500 focus:ring-violet-500 px-3 py-2.5" %>
          </div>
        </div>

        <div>
          <%= render "swatch_groups/style_field", field: 'collection_page_style', value: swatch_group.collection_page_style, label: (SwatchGroup.style_label_for(swatch_group.collection_page_style) || 'Not selected') %>
          <div class="mt-3">
            <label class="block text-sm font-medium text-gray-700">Swatch image source</label>
            <%= f.select :swatch_image_source,
                options_for_select(SwatchGroup::SWATCH_IMAGE_SOURCE, swatch_group.swatch_image_source),
                {},
                class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-violet-500 focus:ring-violet-500 px-3 py-2.5" %>
            <p class="mt-1 text-xs text-gray-500">Applies to both pages for now.</p>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-lg border p-4">
        <%= f.label :css_class_product, class: "block text-sm font-medium text-gray-700" %>
        <%= f.text_field :css_class_product, class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-violet-500 focus:ring-violet-500 px-3 py-2.5" %>
        <%= f.label :css_class_preview, class: "block text-sm font-medium text-gray-700" %>
        <%= f.text_field :css_class_preview, class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-violet-500 focus:ring-violet-500 px-3 py-2.5" %>
      </div>

      <div class="bg-white rounded-lg border p-4">
        <%= f.label :status, class: "block text-sm font-medium text-gray-700" %>
        <%= f.select :status, SwatchGroup.statuses.keys, {}, class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-violet-500 focus:ring-violet-500 px-3 py-2.5" %>
      </div>

    </div>
  </div>

  <div>
    <%= f.submit t(:save), class: "inline-flex items-center px-3 py-1 bg-violet-600 text-white rounded-md hover:bg-violet-700" %>
    <%= link_to t(:back), account_swatch_groups_path(current_account), class: "inline-flex items-center px-3 py-1 bg-white text-violet-700 border border-violet-600 rounded-md hover:bg-violet-50", data: {turbo: false} %>
  </div>
<% end %>
