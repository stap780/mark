<%= turbo_frame_tag dom_id(current_account, dom_id(automation_message)) do %>
    <div class="grid grid-cols-[50_150px_200px_200px_200px_200px_1fr_auto] gap-4 p-4 items-center hover:bg-gray-50">
      <div class="text-sm"><%= automation_message.id %></div>
      <div class="text-sm"><%= automation_message.created_at.strftime("%d.%m.%Y %H:%M") %></div>
      <div class="text-sm">
        <% if automation_message.automation_rule.present? %>
          <%= automation_message.automation_rule&.title %>
        <% else %>
          —
        <% end %>
      </div>
      <div class="text-sm">
        <% if automation_message.client.present? %>
          <%= automation_message.client.full_name %>
        <% elsif automation_message.user.present? %>
          <%= automation_message.user.email_address %> (пользователь)
        <% else %>
          —
        <% end %>
      </div>
      <div class="text-sm flex items-center justify-between">
        <div><%= automation_message.channel.humanize %></div>
        <div class="mt-1">
          <% case automation_message.status %>
          <% when 'sent' %>
            <span class="px-2 py-1 text-xs bg-green-100 text-green-800 rounded">Отправлено</span>
          <% when 'failed' %>
            <span class="px-2 py-1 text-xs bg-red-100 text-red-800 rounded">Ошибка</span>
          <% when 'pending' %>
            <span class="px-2 py-1 text-xs bg-yellow-100 text-yellow-800 rounded">Ожидает</span>
          <% when 'delivered' %>
            <span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded">Доставлено</span>
          <% end %>
        </div>
        <% if automation_message.email? && (automation_message.message_id.present? || automation_message.x_track_id.present?) %>
          <%= link_to check_status_account_automation_message_path(current_account, automation_message), data: {turbo_stream: true, turbo_prefetch: false},
          class: "p-2 rounded-md bg-violet-100 hover:bg-violet-200 flex items-center justify-center", title: "Проверить статус" do %>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path>
          </svg>
          <% end %>
        <% end %>
      </div>
      <div class="text-sm">
        <%= automation_message.subject %>
        <% if automation_message.error_message.present? %>
          <div class="text-xs text-red-600 mt-1"><strong>Ошибка:</strong> <%= automation_message.error_message %></div>
        <% end %>
      </div>
      <div class="text-sm flex items-center gap-2">
        <%= button_to account_automation_message_path(current_account, automation_message),
            method: :delete,
            data: { 
              turbo_stream: true,
              turbo_confirm: "Вы уверены, что хотите удалить это сообщение?"
            },
            class: "p-2 rounded-md bg-red-100 hover:bg-red-200 text-red-700",
            title: "Удалить сообщение" do %>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
          </svg>
        <% end %>
      </div>
    </div>

<% end %>